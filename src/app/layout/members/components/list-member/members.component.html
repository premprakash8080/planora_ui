<div class="page-container members-page">
  <app-page-title
    title="Team Members"
    description="Manage and track your project team"
  >
    <ng-container pageActions>
      <app-button variant="primary" (pressed)="onAddMember()">
        <mat-icon>person_add</mat-icon>
        Invite Member
      </app-button>
    </ng-container>
  </app-page-title>

  <app-card padding="lg">
    <div class="members-toolbar">
      <mat-form-field appearance="outline" class="members-toolbar__search">
        <mat-label>Search members</mat-label>
        <input
          matInput
          placeholder="Search by name or role"
          [(ngModel)]="searchTerm"
          (ngModelChange)="applyFilters()"
        >
        <button
          mat-icon-button
          matSuffix
          *ngIf="searchTerm"
          (click)="clearSearch()"
          aria-label="Clear search"
        >
          <mat-icon>close</mat-icon>
        </button>
      </mat-form-field>

      <div class="members-toolbar__filters">
        <mat-form-field appearance="outline">
          <mat-label>Role</mat-label>
          <mat-select [value]="selectedRole" (selectionChange)="onRoleChange($event)">
            <mat-option *ngFor="let role of roles" [value]="role">{{ role }}</mat-option>
          </mat-select>
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Status</mat-label>
          <mat-select [value]="selectedStatus" (selectionChange)="onStatusChange($event)">
            <mat-option *ngFor="let status of statuses" [value]="status">{{ status }}</mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>

    <!-- Loading State -->
    <div class="members-loading" *ngIf="loading">
      <mat-spinner diameter="40"></mat-spinner>
      <p>Loading members...</p>
    </div>

    <div class="members-table-wrapper" *ngIf="!loading">
      <table mat-table [dataSource]="dataSource" matSort class="members-table">
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Name</th>
          <td mat-cell *matCellDef="let member">
            <div class="member-cell">
              <app-avatar
                [src]="member.avatarUrl"
                [initials]="member.initials"
                [color]="member.avatarColor"
                [alt]="member.name"
                class="member-avatar"
              ></app-avatar>
              <div class="member-info">
                <span class="member-name">{{ member.name }}</span>
                <span class="member-email">{{ member.email }}</span>
              </div>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="role">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Role</th>
          <td mat-cell *matCellDef="let member">
            <span class="member-role-text">{{ member.role }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="projectsAssigned">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Projects</th>
          <td mat-cell *matCellDef="let member">
            <span class="projects-count">{{ member.projectsAssigned }}</span>
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let member">
            <span class="status-badge" [ngClass]="'status-' + member.status.toLowerCase()">
              {{ member.status }}
            </span>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns" class="members-table-header"></tr>
        <tr 
          mat-row 
          *matRowDef="let row; columns: displayedColumns; trackBy: trackByMemberId"
          (click)="onMemberClick(row)"
          class="member-row"
        ></tr>
      </table>
    </div>

    <div class="members-empty" *ngIf="!loading && displayedMembers.length === 0">
      <mat-icon>people_outline</mat-icon>
      <h3>No members found</h3>
      <p>Try adjusting your search or filters.</p>
    </div>
  </app-card>
</div>